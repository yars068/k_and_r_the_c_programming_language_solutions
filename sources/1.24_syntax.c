#include <stdio.h>
#include "../include/custom_functions.h"

/* Write a program to check C program for the syntax errors like */
/* unpaired brackets, quotes, broken escape sequences and comments 
/* and so on. */

#define BUFSIZE 1024
#define OFFSET 16
#define FALSE -1

int get_line(char buf[], int lim, char msg[]) {
  int c, len;
  c = len = 0;

  printf("%s", msg);
  while ((len < (lim - 1)) && (c = getchar()) != EOF && c != '\n')
    buf[len++] = c;

  if (c == '\n') buf[len++] = c;
  
  buf[len] = '\0';
  return len;
}

int get_keyword(char buf[], char res[], int number, int offset) {
  int i = 0;
  int len = 0;
  int ret = FALSE;
  int first_item = (number * offset) + 1;
  
  len = buf[number * offset];
  if (len >= 0) {
    while ((buf[first_item] != 0) && (i < len)) {
      res[i] = buf[first_item + i];
      ++i;
    }
    ret = len;
  }
  else ret = FALSE;
  return ret;
}

int main(void) {
  int i, kw_len, len, number;
  char keyword[BUFSIZE] = {'\0'};
  char buf[BUFSIZE] = {'\0'};
  char keywords[] = { 6, 's', 'i', 'z', 'e', 'o', 'f', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      7, 't', 'y', 'p', 'e', 'd', 'e', 'f', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'a', 'u', 't', 'o', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, 'r', 'e', 'g', 'i', 's', 't', 'e', 'r', '0', '0', '0', '0', '0', '0', '0', 
                      6, 'e', 'x', 't', 'e', 'r', 'n', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      6, 's', 't', 'a', 't', 'i', 'c', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'v', 'o', 'i', 'd', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'c', 'h', 'a', 'r', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      5, 's', 'h', 'o', 'r', 't', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      3, 'i', 'n', 't', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'l', 'o', 'n', 'g', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      6, 's', 'i', 'g', 'n', 'e', 'd', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, 'u', 'n', 's', 'i', 'g', 'n', 'e', 'd', '0', '0', '0', '0', '0', '0', '0', 
                      5, 'f', 'l', 'o', 'a', 't', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      6, 'd', 'o', 'u', 'b', 'l', 'e', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      5, 'c', 'o', 'n', 's', 't', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, 'v', 'o', 'l', 'a', 't', 'i', 'l', 'e', '0', '0', '0', '0', '0', '0', '0', 
                      6, 's', 't', 'r', 'u', 'c', 't', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'e', 'n', 'u', 'm', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      5, 'u', 'n', 'i', 'o', 'n', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      2, 'd', 'o', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      3, 'f', 'o', 'r', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      5, 'w', 'h', 'i', 'l', 'e', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      2, 'i', 'f', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'e', 'l', 's', 'e', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      6, 's', 'w', 'i', 't', 'c', 'h', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'c', 'a', 's', 'e', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      7, 'd', 'e', 'f', 'a', 'u', 'l', 't', '0', '0', '0', '0', '0', '0', '0', '0', 
                      5, 'b', 'r', 'e', 'a', 'k', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, 'c', 'o', 'n', 't', 'i', 'n', 'u', 'e', '0', '0', '0', '0', '0', '0', '0', 
                      4, 'g', 'o', 't', 'o', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      6, 'r', 'e', 't', 'u', 'r', 'n', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      6, 'i', 'n', 'l', 'i', 'n', 'e', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, 'r', 'e', 's', 't', 'r', 'i', 'c', 't', '0', '0', '0', '0', '0', '0', '0', 
                      5, '_', 'B', 'o', 'o', 'l', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, '_', 'C', 'o', 'm', 'p', 'l', 'e', 'x', '0', '0', '0', '0', '0', '0', '0', 
                     10, '_', 'I', 'm', 'a', 'g', 'i', 'n', 'a', 'r', 'y', '0', '0', '0', '0', '0', 
                      7, '_', 'A', 't', 'o', 'm', 'i', 'c', '0', '0', '0', '0', '0', '0', '0', '0', 
                      8, '_', 'A', 'l', 'i', 'g', 'n', 'a', 's', '0', '0', '0', '0', '0', '0', '0', 
                      8, '_', 'A', 'l', 'i', 'g', 'n', 'o', 'f', '0', '0', '0', '0', '0', '0', '0', 
                      8, '_', 'G', 'e', 'n', 'e', 'r', 'i', 'c', '0', '0', '0', '0', '0', '0', '0', 
                      9, '_', 'N', 'o', 'r', 'e', 't', 'u', 'r', 'n', '0', '0', '0', '0', '0', '0', 
                     14, '_', 'S', 't', 'a', 't', 'i', 'c', '_', 'a', 's', 's', 'e', 'r', 't', '0', 
                     13, '_', 'T', 'h', 'r', 'e', 'a', 'd', '_', 'l', 'o', 'c', 'a', 'l', '0', '0'
                     };

  while ((len = get_line(buf, BUFSIZE, "Enter record number: ")) > 0) {
    if ((number = chartodig(buf, len)) >= 0) {
      printf("Showing record %d...\n", number);
      for (i = 0; keyword[i] != '\0'; ++i) keyword[i] = '\0'; /* res is response from get_keyword(), so need to clean it before next call */
      printf("Acquiring database... ");
      printf("Size of database is %d bytes (%d bytes per line, %d lines)\n", sizeof(keywords), OFFSET, ((sizeof(keywords)/OFFSET)));
      if ((kw_len = get_keyword(keywords, keyword, number, OFFSET)) != FALSE)
        printf("Keyword number %d found, is \'%s\'\n",number, keyword);
    }
  }
  return 0;
}
